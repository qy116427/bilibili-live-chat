(function(e){function t(t){for(var a,o,i=t[0],u=t[1],s=t[2],l=0,d=[];l<i.length;l++)o=i[l],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&d.push(r[o][0]),r[o]=0;for(a in u)Object.prototype.hasOwnProperty.call(u,a)&&(e[a]=u[a]);f&&f(t);while(d.length)d.shift()();return c.push.apply(c,s||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],a=!0,i=1;i<n.length;i++){var u=n[i];0!==r[u]&&(a=!1)}a&&(c.splice(t--,1),e=o(o.s=n[0]))}return e}var a={},r={live:0},c=[];function o(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var s=0;s<i.length;s++)t(i[s]);var f=u;c.push([1,"chunk-common","chunk-live-vendors"]),n()})({1:function(e,t,n){e.exports=n("bf33")},"2c9b":function(e,t,n){"use strict";n("39ab")},"39ab":function(e,t,n){},4998:function(e,t,n){"use strict";n("f21b")},"87a9":function(e,t,n){},bf33:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("5595");var a=n("7a23");function r(e,t,n,r,c,o){var i=Object(a["u"])("danmaku-item"),u=Object(a["u"])("live");return r.errMsg?(Object(a["o"])(),Object(a["d"])(i,{key:0,type:"info",message:r.errMsg},null,8,["message"])):r.ready?(Object(a["o"])(),Object(a["d"])(u,Object(a["l"])(Object(a["i"])({key:1},r.props)),null,16)):Object(a["e"])("",!0)}n("18a5");var c=n("f6cc"),o=(n("d3b7"),n("ac1f"),n("5319"),n("72bf")),i=!0,u=function(e){return i=e},s=function(e){return fetch(e).then((function(e){return e.json()}))},f=function(e){return fetch("https://json2jsonp.com/?".concat(Object(o["stringify"])({url:e,callback:"_"}))).then((function(e){return e.text()})).then((function(e){return JSON.parse(e.replace(/^_\((.*)\)$/,"$1"))}))},l=function(e){return i?s(e):f(e)},d=n("1da1"),b=n("3835"),m=n("4416"),p=n.n(m),v=n("3bb8"),j=n.n(v),O=n("b047"),g=n.n(O),h=(n("96cf"),n("1276"),n("99af"),n("4ec9"),n("3ca3"),n("ddb0"),n("d81d"),n("4de4"),n("4fad"),n("a9e3"),n("a630"),n("caad"),n("2532"),n("5d2d")),k=function(){return Math.floor(Date.now()/864e5)},y={method:"false",expireDay:7},w=function(e){return Object.assign(y,e)},S=function(e){switch(y.method){case"imjad":return s("https://api.obfs.dev/api/bilibili/v3/user_info?uid=".concat(e,"&size=1")).then((function(e){var t,n;return null===(t=e.data)||void 0===t||null===(n=t.card)||void 0===n?void 0:n.face}));default:return l("https://api.bilibili.com/x/space/acc/info?mid=".concat(e)).then((function(e){var t;return null===(t=e.data)||void 0===t?void 0:t.face}))}},x=function(e){var t=Object(b["a"])(e,2),n=t[0],a=t[1];a||(a="member/noface.jpg");var r=p()(a.split(".")),c="https://i".concat(n,".hdslb.com/bfs/face/").concat(a);return"gif"===r?[[c,0]]:[["".concat(c,"_48x48.").concat(r),2e3],[c,5e3]]},_=function(e){var t=Object(b["a"])(e,3),n=t[2];return!n||k()-n>=y.expireDay},L=new Map(Object.entries(Object(h["a"])("face",{})).filter((function(e){var t=Object(b["a"])(e,2),n=t[1];return!_(n)})).map((function(e){var t=Object(b["a"])(e,2),n=t[0],a=t[1];return[Number(n),a]}))),R=g()((function(){return Object(h["b"])("face",j()(Array.from(L)))}),5e3,{maxWait:5e3}),T=function(e,t){var n;if(t){var a=parseInt(null===(n=/\/\/i(\d+)\./.exec(t))||void 0===n?void 0:n[1])||0,r=p()(t.split("/")),c=r.includes("noface")?[0,null,k()]:[a,r,k()];return L.set(e,c),R(),c}},E=function(){var e=Object(d["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=L.get(t),!n||_(n)){e.next=3;break}return e.abrupt("return",x(n));case 3:return e.prev=3,e.t0=x,e.t1=T,e.t2=t,e.next=9,S(t);case 9:return e.t3=e.sent,e.t4=(0,e.t1)(e.t2,e.t3),e.abrupt("return",(0,e.t0)(e.t4));case 14:e.prev=14,e.t5=e["catch"](3),console.error("[face API error]",e.t5);case 17:return e.abrupt("return",x([0,null]));case 18:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(t){return e.apply(this,arguments)}}(),D={id:"live"};function M(e,t,n,r,c,o){var i=Object(a["u"])("danmaku-list");return Object(a["o"])(),Object(a["f"])("div",D,[r.props.giftPin?(Object(a["o"])(),Object(a["d"])(i,Object(a["i"])({key:0,ref:"giftPinList"},r.props,{"gift-show-face":r.giftShowFace,"is-gift-list":!0}),null,16,["gift-show-face"])):Object(a["e"])("",!0),Object(a["h"])(i,Object(a["i"])({ref:"danmakuList"},r.props),null,16)])}var P=n("5530"),N=(n("6062"),n("498a"),n("fcfc")),A={key:0,class:"danmaku-list-pinned",ref:"danmakuListRef"},F={class:"danmaku-list hidden"},I={class:"danmaku-list absolute",ref:"giftListRef"},G={key:1,class:"danmaku-list",ref:"danmakuListRef"},C={key:0,class:"danmaku-list-placeholder"};function B(e,t,n,r,c,o){var i=Object(a["u"])("danmaku-item");return n.isGiftList?(Object(a["o"])(),Object(a["f"])("div",A,[Object(a["g"])("div",F,[(Object(a["o"])(!0),Object(a["f"])(a["a"],null,Object(a["s"])(e.giftPin,(function(e){return Object(a["o"])(),Object(a["d"])(i,{key:e,"show-face":n.giftShowFace,type:"gift",uname:"某人",giftName:"礼物",num:e},null,8,["show-face","num"])})),128))]),Object(a["g"])("div",I,[(Object(a["o"])(!0),Object(a["f"])(a["a"],null,Object(a["s"])(r.danmakuList,(function(e){return Object(a["o"])(),Object(a["d"])(i,Object(a["i"])({key:e.key},e.props,{hidden:e.hidden,ref_for:!0,ref:function(t){return e.el=t}}),null,16,["hidden"])})),128))],512)],512)):(Object(a["o"])(),Object(a["f"])("div",G,["bottom"===e.display?(Object(a["o"])(),Object(a["f"])("div",C)):Object(a["e"])("",!0),(Object(a["o"])(!0),Object(a["f"])(a["a"],null,Object(a["s"])(r.danmakuList,(function(e){return Object(a["o"])(),Object(a["d"])(i,Object(a["i"])({key:e.key},e.props,{hidden:e.hidden,ref_for:!0,ref:function(t){return e.el=t}}),null,16,["hidden"])})),128))],512))}var H=n("443d"),U=n.n(H),J=(n("c740"),n("a434"),n("7db0"),n("4e82"),n("b64b"),n("159b"),n("ec26")),z=n("53ca"),$=n("b85c"),W=function(e,t){return new Promise((function(n,a){var r=0,c=new XMLHttpRequest,o=setTimeout((function(){c.abort()}),1e4),i=t?setTimeout((function(){0===r&&c.abort()}),t):null;c.open("GET",e,!0),c.onprogress=function(e){e.lengthComputable&&(r=e.loaded/e.total)},c.onload=function(){clearTimeout(i),clearTimeout(o),n(e)},c.onerror=a,c.onabort=a,c.send()}))},q=function(){var e=Object(d["a"])(regeneratorRuntime.mark((function e(t){var n,a,r,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=Object($["a"])(t),e.prev=1,r=regeneratorRuntime.mark((function e(){var t,n,r,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=Object(b["a"])(a.value,2),n=t[0],r=t[1],e.next=3,W(n,r).catch((function(){console.warn("Timeout",n)}));case 3:if(c=e.sent,!c){e.next=6;break}return e.abrupt("return",{v:c});case 6:case"end":return e.stop()}}),e)})),n.s();case 4:if((a=n.n()).done){e.next=11;break}return e.delegateYield(r(),"t0",6);case 6:if(c=e.t0,"object"!==Object(z["a"])(c)){e.next=9;break}return e.abrupt("return",c.v);case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e["catch"](1),n.e(e.t1);case 16:return e.prev=16,n.f(),e.finish(16);case 19:return e.abrupt("return",t[0][0]||"");case 20:case"end":return e.stop()}}),e,null,[[1,13,16,19]])})));return function(t){return e.apply(this,arguments)}}(),K=["src"],X={key:1,class:"danmaku-content"},Y={class:"danmaku-message"},Q={key:2,class:"danmaku-content"},V=Object(a["g"])("span",{class:"danmaku-message"},"感谢 ",-1),Z={class:"danmaku-author-name"},ee=Object(a["g"])("span",{class:"danmaku-message"}," 赠送 ",-1),te={class:"danmaku-gift-name"},ne=Object(a["g"])("span",{class:"danmaku-message"}," × ",-1),ae={class:"danmaku-gift-num"},re={key:3,class:"danmaku-content"},ce=Object(a["g"])("span",{class:"danmaku-message"},"感谢 ",-1),oe={class:"danmaku-author-name"},ie={class:"danmaku-message"},ue={key:4,class:"danmaku-content"},se={class:"danmaku-message"};function fe(e,t,n,r,c,o){return Object(a["o"])(),Object(a["f"])("div",{class:Object(a["k"])(["danmaku-item",{hidden:r.isHidden}])},[n.showFace?(Object(a["o"])(),Object(a["f"])("img",{key:0,class:"danmaku-author-face",src:n.face},null,8,K)):Object(a["e"])("",!0),"message"===n.type?(Object(a["o"])(),Object(a["f"])("div",X,[Object(a["g"])("span",{class:Object(a["k"])(["danmaku-author-name with-colon",{anchor:n.isAnchor,owner:n.isOwner}])},Object(a["v"])(n.uname),3),Object(a["g"])("span",Y,Object(a["v"])(n.message),1)])):"gift"===n.type?(Object(a["o"])(),Object(a["f"])("div",Q,[V,Object(a["g"])("span",Z,Object(a["v"])(n.uname),1),ee,Object(a["g"])("span",te,Object(a["v"])(n.giftName),1),ne,Object(a["g"])("span",ae,Object(a["v"])(n.num),1)])):"sc"===n.type?(Object(a["o"])(),Object(a["f"])("div",re,[ce,Object(a["g"])("span",oe,Object(a["v"])(n.uname),1),Object(a["g"])("span",ie," 的SC："+Object(a["v"])(n.message),1)])):"info"===n.type?(Object(a["o"])(),Object(a["f"])("div",ue,[Object(a["g"])("span",se,Object(a["v"])(n.message),1)])):Object(a["e"])("",!0)],2)}var le={props:{type:{type:String,default:"message"},showFace:Boolean,face:String,uid:Number,uname:String,message:String,isAnchor:Boolean,isOwner:Boolean,action:String,giftName:String,num:Number,stay:Number,hidden:Boolean},setup:function(e){var t=Object(a["r"])(!1),n=Object(a["r"])(!1);if(e.stay){var r=setTimeout((function(){t.value=!0,"info"===e.type&&setTimeout((function(){return n.value=!0}),800)}),e.stay);Object(a["m"])((function(){return clearTimeout(r)}))}var c=Object(a["b"])((function(){return e.hidden||t.value}));return Object(P["a"])(Object(P["a"])({},Object(a["w"])(e)),{},{isHidden:c,needRemoved:n})}},de=(n("dfee"),n("6b0d")),be=n.n(de);const me=be()(le,[["render",fe]]);var pe=me,ve=new Map,je={components:{DanmakuItem:pe},props:Object(P["a"])(Object(P["a"])({},c["d"]),{},{isGiftList:Boolean,giftShowFace:Boolean}),setup:function(e){var t=!0;Object(a["m"])((function(){return t=!1}));var n=Object(a["r"])([]),r=Object(a["r"])(null),c=Object(a["r"])(null);Object(a["n"])((function(){var e=r.value.getBoundingClientRect().top-5,t=function(){var t=n.value.findIndex((function(t){var n,a,r,c,o=null!==(n=null===(a=t.el)||void 0===a||null===(r=a.$el)||void 0===r?void 0:r.getBoundingClientRect())&&void 0!==n?n:{},i=o.top,u=void 0===i?e:i,s=o.height,f=void 0===s?0:s;return u<e&&(t.hidden=!0),u+f>e&&!(null!==(c=t.el)&&void 0!==c&&c.needRemoved)}));t>0&&n.value.splice(0,t)},c=setInterval(t,100);Object(a["m"])((function(){return clearInterval(c)}))}));var o=function(){var t=Object(a["x"])(e.isGiftList?c:r);t&&(t.scrollTop=t.scrollHeight)};e.isGiftList||(Object(a["n"])((function(){return window.addEventListener("resize",o)})),Object(a["m"])((function(){return window.removeEventListener("resize",o)})));var i=[],u=function e(){var r=200,c=i.length;c>0&&(r=Math.min(r,1e3/c),n.value.push(i.shift()),Object(a["j"])(o)),t&&setTimeout(e,r)};u();var s=function(){var t=Object(d["a"])(regeneratorRuntime.mark((function t(n){var a,r,c,o,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n.showFace){t.next=19;break}return t.next=3,E(n.uid);case 3:if(a=t.sent,c=a.find((function(e){var t=Object(b["a"])(e,1),n=t[0];return r=ve.get(n)}))||[""],o=Object(b["a"])(c,1),u=o[0],u){t.next=14;break}return r=q(a),ve.set(u,r),t.next=10,r;case 10:u=t.sent,ve.set(u,!0),t.next=18;break;case 14:if(!0===r){t.next=18;break}return t.next=17,r;case 17:u=t.sent;case 18:n.face=u;case 19:n.stay=n.stay||("bottom"===e.display?e.stay:0),i.push({props:n,key:Object(J["a"])(),el:null,hidden:!1});case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),f=[];if(e.limit){var l=setInterval((function(){var t=f.splice(0);t.length&&(t.length>e.limit&&(t=U()(Object.keys(t),e.limit).sort().map((function(e){return t[e]}))),t.forEach((function(e){return s(e)})))}),1e3);Object(a["m"])((function(){return clearInterval(l)}))}var m=function(e){return f.push(e)};return Object(P["a"])(Object(P["a"])({},Object(a["w"])(e)),{},{danmakuList:n,danmakuListRef:r,giftListRef:c,addDanmaku:s,addSpeedLimitDanmaku:m})}};n("4998");const Oe=be()(je,[["render",B]]);var ge=Oe,he={components:{DanmakuList:ge},props:c["d"],setup:function(e){var t=Object(a["r"])(null),n=Object(a["r"])(null),r=new Map,c=Object(a["b"])((function(){return!["false","gift"].includes(e.face)})),o=Object(a["b"])((function(){return new Set(e.blockUID.split("|").map((function(e){return e.trim()})))})),i=function(e){return o.value.has(String(e))},u=function(t){n.value.addDanmaku({type:"info",message:t,stay:e.stay||5e3})},s=function(t){e.limit?n.value.addSpeedLimitDanmaku(t):n.value.addDanmaku(t)};return Object(a["n"])((function(){console.log("正在连接直播弹幕服务器");var o=new N["KeepLiveWS"](e.room);Object(a["m"])((function(){return o.close()})),o.on("open",(function(){console.log("已连接直播弹幕服务器"),u("已连接直播弹幕服务器")})),o.on("live",(function(){console.log("已连接直播间",e.room),u("已连接直播间 ".concat(e.room))})),o.on("close",(function(){return console.log("已断开与直播弹幕服务器的连接")})),o.on("heartbeat",(function(e){return console.log("当前人气值",e)}));var f=e.giftPin?t:n;o.on("SEND_GIFT",(function(t){var n=t.data,a=n.uid,c=n.uname,o=n.action,u=n.giftName,s=n.num,l=n.face;if(i(a))console.log("屏蔽了来自[".concat(c,"]的礼物：").concat(u,"*").concat(s));else if(T(a,l),e.giftComb){var d="".concat(a,"-").concat(u),b=r.get(d);b?r.set(d,Object(P["a"])(Object(P["a"])({},b),{},{num:b.num+s})):(r.set(d,{type:"gift",showFace:"false"!==e.face,uid:a,uname:c,action:o,giftName:u,num:s}),setTimeout((function(){f.value.addDanmaku(r.get(d)),r.delete(d)}),e.giftComb))}else f.value.addDanmaku({type:"gift",showFace:"false"!==e.face,uid:a,uname:c,action:o,giftName:u,num:s})})),o.on("DANMU_MSG",(function(t){var n=Object(b["a"])(t.info,3),a=n[1],r=Object(b["a"])(n[2],3),o=r[0],u=r[1],f=r[2];if(i(o))console.log("屏蔽了来自[".concat(u,"]的弹幕：").concat(a));else{var l={type:"message",showFace:c.value,uid:o,uname:u,message:a,isAnchor:o===e.anchor,isOwner:!!f};e.delay>0?setTimeout((function(){return s(l)}),1e3*e.delay):s(l)}})),o.on("SUPER_CHAT_MESSAGE",(function(t){console.log("SUPER_CHAT_MESSAGE",t);var n=t.data,a=n.uid,r=n.user_info.uname,c=n.message;f.value.addDanmaku({type:"sc",showFace:"false"!==e.face,uid:a,uname:r,message:c})})),window.giftList=f,o.on("SUPER_CHAT_MESSAGE_JPN",(function(e){return console.log("SUPER_CHAT_MESSAGE_JPN",e)})),o.on("USER_TOAST_MSG",(function(t){var n=t.data,a=n.uid,r=n.username,c=n.role_name,o=n.num;f.value.addDanmaku({type:"gift",showFace:"false"!==e.face,uid:a,uname:r,giftName:c,num:o})}))})),{props:e,giftShowFace:c,giftPinList:t,danmakuList:n}}};n("d735");const ke=be()(he,[["render",M]]);var ye=ke,we={components:{Live:ye,DanmakuItem:pe},setup:function(){var e=function(){return window.location.reload()};window.addEventListener("hashchange",e),Object(a["m"])((function(){return window.removeEventListener("hashchange",e)}));var t=Object(a["p"])(Object(c["c"])(window.location.hash)),n="true"===t.cors;u(n),w({method:t.face,expireDay:t.faceExpireDay});var r=Object(a["r"])(!1),o=Object(a["r"])("");return l("https://api.live.bilibili.com/room_ex/v1/RoomNews/get?roomid=".concat(t.room)).then((function(e){var n=e.code,a=e.msg,c=e.data,i=c.roomid,u=c.uid;0===n?(t.room=parseInt(i),t.anchor=parseInt(u),r.value=!0):o.value=a})).catch((function(){o.value="获取房间信息失败",n&&(o.value+="，请检查是否正确禁用了浏览器的 web security 以允许直接跨域")})),{props:t,ready:r,errMsg:o}}};n("2c9b");const Se=be()(we,[["render",r]]);var xe=Se;Object(a["c"])(xe).mount("#app")},d72a:function(e,t,n){},d735:function(e,t,n){"use strict";n("87a9")},dfee:function(e,t,n){"use strict";n("d72a")},f21b:function(e,t,n){}});